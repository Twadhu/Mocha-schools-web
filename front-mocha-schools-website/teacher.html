<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <link rel="stylesheet" href="css/site.css">
  <link rel="stylesheet" href="css/teacher-portal.css">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø¹Ù„Ù…</title>
</head>
<body>
  <div id="profileModal" class="modal-overlay">
    <div class="modal-box">
      <button onclick="closeProfile()" class="modal-close">&times;</button>
  <h2 class="text-center profile-title">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
      <form id="profileForm" enctype="multipart/form-data">
  <div class="text-center mb-16">
          <img id="profilePic" src="https://ui-avatars.com/api/?name=Teacher" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©" class="profile-avatar">
          <br>
          <label for="profilePicInput" class="sr-only">Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</label>
          <input type="file" id="profilePicInput" accept="image/*" class="block" title="Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ">
        </div>
        <label for="profileName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
        <input type="text" id="profileName" required class="block" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" title="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
        <label for="profileEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input type="email" id="profileEmail" required class="block" placeholder="example@mail.com" title="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <label for="profilePhone">Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
        <input type="text" id="profilePhone" class="block" placeholder="05xxxxxxxx" title="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„">
        <button type="submit" class="btn-primary">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
        <div id="profileMsg" class="note-sm"></div>
      </form>
    </div>
  </div>
  <div id="notificationsBar" class="notify-bar">
    <span id="notificationMsg"><i class="fas fa-bell"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</span>
    <button onclick="closeNotification()" class="btn-icon">&times;</button>
  </div>
  <nav class="sidebar">
  <a href="#" onclick="openProfile()" class="profile-link">ğŸ‘¤ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</a>
    <div class="logo">ğŸ§‘â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…</div>
    <div class="sidebar-nav">
      <a href="#" onclick="scrollToSection('main')"><i class="fas fa-home"></i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="#" onclick="scrollToSection('homeworkForm')"><i class="fas fa-book"></i>Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ø¬Ø¨</a>
      <a href="#" onclick="scrollToSection('examForm')"><i class="fas fa-file-alt"></i>Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØ¨Ø§Ø±</a>
      <a href="#" onclick="scrollToSection('studentsList')"><i class="fas fa-user-graduate"></i>Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</a>
      <a href="#" onclick="scrollToSection('homeworkList')"><i class="fas fa-tasks"></i>Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</a>
      <a href="#" onclick="scrollToSection('examsList')"><i class="fas fa-clipboard-list"></i>Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</a>
      <a href="#" onclick="scrollToSection('teacherSchedule')"><i class="fas fa-calendar-alt"></i>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­ØµØµ</a>
      <a href="#" onclick="scrollToSection('attendanceList')"><i class="fas fa-user-check"></i>Ø§Ù„Ø­Ø¶ÙˆØ±</a>
  <a href="#" onclick="scrollToSection('messageCenter')"><i class="fas fa-envelope"></i>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</a>
  <a href="#" onclick="scrollToSection('filesCenter')"><i class="fas fa-folder-open"></i>Ø§Ù„Ù…Ù„ÙØ§Øª</a>
  <a href="#" onclick="scrollToSection('dataFilters')"><i class="fas fa-filter"></i>Ø§Ù„ÙÙ„Ø§ØªØ±</a>
    </div>
    <div class="sidebar-bottom">
      <button class="dark-toggle" onclick="toggleDarkMode()"><i class="fas fa-moon"></i>ÙˆØ¶Ø¹ Ù„ÙŠÙ„ÙŠ</button>
  <a href="mocha-schools.html" class="home-link"><i class="fas fa-arrow-right"></i>Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>
  </nav>
  <div class="main-content" id="main">
  <header>
    <div class="container header-container">
      <h1>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ø¹Ù„Ù…</h1>
      <div class="tools">
        <button class="btn btn-primary" onclick="downloadSchedule()">ğŸ“„ Ø¬Ø¯ÙˆÙ„ PDF</button>
        <button class="btn btn-primary" onclick="downloadIdCard()">ğŸªª Ø¨Ø·Ø§Ù‚Ø©</button>
        <button class="btn btn-primary" onclick="loadLists()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
      </div>
      <div id="teacherName"></div>
    </div>
  </header>

  <main class="container">
    <!-- Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
    <div class="card" id="messageCenter">
      <div class="section-header"><h2>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©</h2><span class="badge">ØªØ¬Ø±ÙŠØ¨ÙŠ</span></div>
      <form id="messageForm" class="toolbar-mini">
        <input id="msgTo" placeholder="Ø¥Ù„Ù‰ (Ø¨Ø±ÙŠØ¯)" required class="flex-1 min-140">
        <input id="msgSubject" placeholder="Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹" required class="flex-1 min-160">
        <input id="msgBody" placeholder="Ù†Øµ Ù…Ø®ØªØµØ±" required class="flex-2 min-200">
        <button type="submit" class="btn btn-primary">Ø¥Ø±Ø³Ø§Ù„</button>
      </form>
      <div class="toolbar-mini">
        <input id="msgSearch" class="filter-input" placeholder="Ø¨Ø­Ø«..." oninput="filterMessages()">
        <button type="button" class="pill-btn" onclick="clearMessages()">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
      </div>
      <table>
        <thead><tr><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø¥Ù„Ù‰</th><th>Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</th><th>Ø§Ù„Ù†Øµ</th></tr></thead>
        <tbody id="messagesTable"><tr><td colspan="4" class="muted text-center">Ù„Ø§ Ø±Ø³Ø§Ø¦Ù„</td></tr></tbody>
      </table>
    </div>

    <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„ÙØ§Øª -->
    <div class="card" id="filesCenter">
      <div class="section-header"><h2>Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</h2><span class="badge">ØªØ¬Ø±ÙŠØ¨ÙŠ</span></div>
      <form id="fileForm" class="toolbar-mini" enctype="multipart/form-data">
        <label for="fileInput" class="sr-only">Ø§Ø®ØªØ± Ù…Ù„Ù</label>
        <input type="file" id="fileInput" required title="Ø§Ø®ØªØ± Ù…Ù„Ù Ù„Ù„Ø±ÙØ¹" aria-label="Ø§Ø®ØªØ± Ù…Ù„Ù">
  <input type="text" id="fileLabel" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ±" class="flex-1 min-160">
        <button type="submit" class="btn btn-primary">Ø±ÙØ¹</button>
        <button type="button" class="btn btn-outline" onclick="exportFilesCSV()">ØªØµØ¯ÙŠØ± CSV</button>
      </form>
      <ul id="fileList" class="file-list list-reset">
        <li class="muted justify-center">Ù„Ø§ Ù…Ù„ÙØ§Øª</li>
      </ul>
    </div>

    <!-- ÙÙ„Ø§ØªØ± Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© -->
    <div class="card" id="dataFilters">
      <div class="section-header"><h2>ÙÙ„Ø§ØªØ± Ø³Ø±ÙŠØ¹Ø©</h2><span class="badge">Ø¨Ø­Ø«</span></div>
      <div class="toolbar-mini">
        <input id="filterHomework" class="filter-input" placeholder="Ø¨Ø­Ø« Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª" oninput="filterTable('homeworkList','filterHomework')">
        <input id="filterExams" class="filter-input" placeholder="Ø¨Ø­Ø« Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª" oninput="filterTable('examsList','filterExams')">
        <input id="filterSchedule" class="filter-input" placeholder="Ø¨Ø­Ø« Ø§Ù„Ø¬Ø¯ÙˆÙ„" oninput="filterTable('teacherSchedule','filterSchedule')">
  <button type="button" class="btn btn-outline" onclick="exportTableCSV('homeworkList','homework.csv')">ÙˆØ§Ø¬Ø¨Ø§Øª CSV</button>
  <button type="button" class="btn btn-outline" onclick="exportTableCSV('examsList','exams.csv')">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª CSV</button>
  <button type="button" class="btn btn-outline" onclick="exportTableCSV('teacherSchedule','schedule.csv')">Ø¬Ø¯ÙˆÙ„ CSV</button>
      </div>
  </div>
  <div class="grid">
      <div class="card">
        <h2>Ø¥Ø¶Ø§ÙØ© ÙˆØ§Ø¬Ø¨ Ù…Ù†Ø²Ù„ÙŠ</h2>
        <form id="homeworkForm" novalidate>
          <div>
            <label for="subject">Ø§Ù„Ù…Ø§Ø¯Ø©</label><br>
            <select id="subject" required aria-label="Ø§Ù„Ù…Ø§Ø¯Ø©"></select>
          </div>
          <div>
            <label for="class_level">Ø§Ù„ØµÙ</label><br>
            <select id="class_level" required aria-label="Ø§Ù„ØµÙ">
              <option value="first">Ø§Ù„Ø£ÙˆÙ„</option>
              <option value="second">Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
              <option value="third">Ø§Ù„Ø«Ø§Ù„Ø«</option>
            </select>
          </div>
          <div>
            <label for="section">Ø§Ù„Ø´Ø¹Ø¨Ø©</label><br>
            <input id="section" placeholder="A/B/C" />
          </div>
          <div>
            <label for="homework_title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ§Ø¬Ø¨</label><br>
            <input type="text" id="homework_title" required placeholder="Ù…Ø«Ø§Ù„: ÙˆØ§Ø¬Ø¨ Ø§Ù„ÙˆØ­Ø¯Ø© 2 - Ø±ÙŠØ§Ø¶ÙŠØ§Øª">
          </div>
          <div>
            <label for="homework_content">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ø¨</label><br>
            <textarea id="homework_content" rows="4" required placeholder="Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª..."></textarea>
          </div>
          <div>
            <label for="due_date">Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…</label><br>
            <input type="date" id="due_date" required>
          </div>
          <div>
            <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„ÙˆØ§Ø¬Ø¨</button>
          </div>
          <div id="homeworkMsg" class="msg"></div>
        </form>
      </div>

      <div class="card">
        <h2>Ø¥Ø¶Ø§ÙØ© Ø§Ø®ØªØ¨Ø§Ø±</h2>
        <form id="examForm" novalidate>
          <div>
            <label for="exam_subject">Ø§Ù„Ù…Ø§Ø¯Ø©</label><br>
            <select id="exam_subject" required aria-label="Ù…Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±"></select>
          </div>
          <div>
            <label for="exam_class">Ø§Ù„ØµÙ</label><br>
            <select id="exam_class" required aria-label="ØµÙ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±">
              <option value="first">Ø§Ù„Ø£ÙˆÙ„</option>
              <option value="second">Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
              <option value="third">Ø§Ù„Ø«Ø§Ù„Ø«</option>
            </select>
          </div>
          <div>
            <label for="exam_section">Ø§Ù„Ø´Ø¹Ø¨Ø©</label><br>
            <input id="exam_section" placeholder="A/B/C" />
          </div>
          <div>
            <label for="exam_title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</label><br>
            <input type="text" id="exam_title" required placeholder="Ø§Ø®ØªØ¨Ø§Ø± Ø´Ù‡Ø±ÙŠ 1">
          </div>
          <div>
            <label for="exam_duration">Ù…Ø¯Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± (Ø¯Ù‚Ø§Ø¦Ù‚)</label><br>
            <input type="number" id="exam_duration" min="10" max="180" required placeholder="60">
          </div>
          <div>
            <label for="exam_date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</label><br>
            <input type="date" id="exam_date" required>
          </div>
          <div>
            <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
          </div>
          <div id="examMsg" class="msg"></div>
        </form>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</h2>
        <div class="controls">
          <select id="grade_subject" aria-label="Ù…Ø§Ø¯Ø© Ø§Ù„Ø¯Ø±Ø¬Ø§Øª"></select>
          <select id="grade_class" aria-label="ØµÙ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª">
            <option value="first">Ø§Ù„Ø£ÙˆÙ„</option>
            <option value="second">Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
            <option value="third">Ø§Ù„Ø«Ø§Ù„Ø«</option>
            <option value="fourth">Ø§Ù„Ø±Ø§Ø¨Ø¹</option>
            <option value="fifth">Ø§Ù„Ø®Ø§Ù…Ø³</option>
            <option value="sixth">Ø§Ù„Ø³Ø§Ø¯Ø³</option>
            <option value="seventh">Ø§Ù„Ø³Ø§Ø¨Ø¹</option>
            <option value="eighth">Ø§Ù„Ø«Ø§Ù…Ù†</option>
            <option value="ninth">Ø§Ù„ØªØ§Ø³Ø¹</option>
            <option value="tenth">Ø£ÙˆÙ„ Ø«Ø§Ù†ÙˆÙŠ</option>
            <option value="eleventh">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø«Ø§Ù†ÙˆÙŠ</option>
            <option value="twelfth">Ø§Ù„Ø«Ø§Ù„Ø« Ø«Ø§Ù†ÙˆÙŠ</option>
          </select>
          <input id="grade_section" placeholder="A/B/C" />
          <select id="grade_term" aria-label="ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª">
            <option value="Ø§Ù„Ø£ÙˆÙ„">Ø§Ù„Ø£ÙˆÙ„</option>
            <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ">Ø§Ù„Ø«Ø§Ù†ÙŠ</option>
          </select>
          <select id="grade_month" aria-label="Ø´Ù‡Ø± Ø§Ù„Ø¯Ø±Ø¬Ø§Øª">
            <option value="1">Ø´Ù‡Ø± 1</option>
            <option value="2">Ø´Ù‡Ø± 2</option>
            <option value="3">Ø´Ù‡Ø± 3</option>
          </select>
          <button id="loadStudents" class="btn btn-primary">ØªØ­Ù…ÙŠÙ„</button>
        </div>
        <table>
          <thead><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ø¨Ø±ÙŠØ¯</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th><th>Ø­ÙØ¸</th></tr></thead>
    <tbody id="studentsList"><tr><td colspan="4" class="muted text-center">Ø§Ø®ØªØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø«Ù… ØªØ­Ù…ÙŠÙ„</td></tr></tbody>
        </table>
        <div id="gradeMsg" class="msg"></div>
      </div>

      <div class="card">
        <h2>Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª Ùˆ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h2>
        <h3 class="card-subtitle">Ø§Ù„ÙˆØ§Ø¬Ø¨Ø§Øª</h3>
        <table>
          <thead><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„ØªØ³Ù„ÙŠÙ…</th><th>Ø§Ù„ØµÙ</th><th>Ø§Ù„Ø´Ø¹Ø¨Ø©</th></tr></thead>
          <tbody id="homeworkList"><tr><td colspan="5" class="muted text-center">Ù„Ø§ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr></tbody>
        </table>
        <h3 class="card-subtitle-spaced">Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h3>
        <table>
          <thead><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ø¯Ø©</th><th>Ø§Ù„ØµÙ</th><th>Ø§Ù„Ø´Ø¹Ø¨Ø©</th></tr></thead>
          <tbody id="examsList"><tr><td colspan="6" class="muted text-center">Ù„Ø§ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr></tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <h2>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­ØµØµ</h2>
      <div class="schedule-controls">
        <label>Ø§Ù„ÙØµÙ„:</label>
        <select id="teacherSemester" aria-label="Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ù„Ù„Ø¬Ø¯ÙˆÙ„"><option value="">Ø§Ù„ÙƒÙ„</option><option value="1">Ø§Ù„Ø£ÙˆÙ„</option><option value="2">Ø§Ù„Ø«Ø§Ù†ÙŠ</option></select>
  <button onclick="loadTeacherSchedule()" class="btn btn-primary">ØªØ­Ù…ÙŠÙ„</button>
      </div>
      <table>
        <thead><tr><th>Ø§Ù„ÙØµÙ„</th><th>Ø§Ù„ØµÙ</th><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„Ø­ØµØ©</th><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th></tr></thead>
        <tbody id="teacherSchedule"><tr><td colspan="5" class="muted text-center">â€”</td></tr></tbody>
      </table>
    </div>

    <div class="card">
      <h2>Ø§Ù„Ø­Ø¶ÙˆØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ</h2>
      <div class="controls">
        <select id="att_class" aria-label="ØµÙ Ø§Ù„Ø­Ø¶ÙˆØ±">
          <option value="first">Ø§Ù„Ø£ÙˆÙ„</option><option value="second">Ø§Ù„Ø«Ø§Ù†ÙŠ</option><option value="third">Ø§Ù„Ø«Ø§Ù„Ø«</option>
        </select>
        <input id="att_section" placeholder="A/B/C" aria-label="Ø´Ø¹Ø¨Ø©" />
  <button id="loadAttStudents" class="btn btn-primary">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨</button>
  <button id="markAllPresent" class="btn">Ø§Ù„ÙƒÙ„ Ø­Ø§Ø¶Ø±</button>
        <input type="date" id="attFromT" aria-label="Ù…Ù†" />
        <input type="date" id="attToT" aria-label="Ø¥Ù„Ù‰" />
  <button id="downloadAttPdf" class="btn btn-outline">ØªÙ‚Ø±ÙŠØ± PDF</button>
      </div>
      <table>
        <thead><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø­ÙØ¸</th></tr></thead>
        <tbody id="attendanceList"><tr><td colspan="3" class="muted text-center">â€”</td></tr></tbody>
      </table>
      <div id="attendanceMsg" class="msg hidden"></div>
    </div>
  </main>

  <script>
    function buildApiUrl(path){
      path = path.replace(/^\/+/, '');
      const href = location.pathname; const marker='front-mocha-schools-website'; let basePrefix='../';
      if(href.includes(marker)){
        const after = href.split(marker)[1] || ''; const extra=after.split('/').filter(s=>s.length>0 && s.indexOf('.')===-1); basePrefix='../'.repeat(1+extra.length);
      }
      return basePrefix + path;
    }
    async function apiFetch(path, options={}){
      const res = await fetch(buildApiUrl(path), options);
      if(res.status===401){ location='teacher-login.html?expired=1'; throw new Error('EXPIRED'); }
      return res;
    }
    function auth(){ return { 'Authorization':'Bearer '+localStorage.getItem('authToken'), 'Content-Type':'application/json' }; }
  function fillSubjects(selectIds){ apiFetch('api/subjects.php',{headers:{'Authorization':'Bearer '+localStorage.getItem('authToken')}}).then(r=>r.json()).then(d=>{ if(d.ok){ selectIds.forEach(id=>{ const sel=document.getElementById(id); sel.innerHTML = d.subjects.map(s=>`<option value="${s.name}">${s.name}</option>`).join(''); }); }}); }
    document.addEventListener('DOMContentLoaded', ()=>{
      const user=JSON.parse(localStorage.getItem('currentUser'));
      if(!user){ location='teacher-login.html'; return; }
      document.getElementById('teacherName').textContent = (user.first_name||'')+' '+(user.last_name||'');
      fillSubjects(['subject','exam_subject','grade_subject']);
      loadLists();
      // restore dark mode if previously set
      if(localStorage.getItem('darkMode')==='1'){
        document.body.classList.add('dark-mode');
      }
    });

    async function loadLists(){ loadHomework(); loadExams(); }
  async function loadHomework(){ try{ const r=await apiFetch('api/teacher.php?path=homework',{headers:auth()}); const d=await r.json(); const tb=document.getElementById('homeworkList'); if(!d.ok||!d.items.length){ tb.innerHTML='<tr><td colspan="5" class="muted text-center">Ù„Ø§ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'; return;} tb.innerHTML=d.items.map(i=>`<tr><td>${i.subject}</td><td>${i.title}</td><td>${i.due_date}</td><td>${i.class_level}</td><td>${i.section||''}</td></tr>`).join(''); }catch{}}
  async function loadExams(){ try{ const r=await apiFetch('api/teacher.php?path=exams',{headers:auth()}); const d=await r.json(); const tb=document.getElementById('examsList'); if(!d.ok||!d.items.length){ tb.innerHTML='<tr><td colspan="6" class="muted text-center">Ù„Ø§ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'; return;} tb.innerHTML=d.items.map(i=>`<tr><td>${i.subject}</td><td>${i.title}</td><td>${i.exam_date}</td><td>${i.duration}Ø¯</td><td>${i.class_level}</td><td>${i.section||''}</td></tr>`).join(''); }catch{}}

    // Ø­ÙØ¸ ÙˆØ§Ø¬Ø¨
  document.getElementById('homeworkForm').addEventListener('submit', async e=>{ e.preventDefault(); const msg=document.getElementById('homeworkMsg'); msg.style.display='none'; const payload={ subject:subject.value, class_level:class_level.value, section:section.value.trim(), title:homework_title.value.trim(), content:homework_content.value.trim(), due_date:due_date.value }; if(!payload.subject||!payload.class_level||!payload.title||!payload.content||!payload.due_date){ msg.textContent='Ø§ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„'; msg.className='msg error'; msg.style.display='block'; return;} try{ const r=await apiFetch('api/teacher.php?path=homework',{method:'POST',headers:auth(),body:JSON.stringify(payload)}); const d=await r.json(); if(!d.ok){ throw 0;} msg.textContent='ØªÙ… Ø§Ù„Ø­ÙØ¸'; msg.className='msg ok'; msg.style.display='block'; e.target.reset(); loadHomework(); }catch{ msg.textContent='ÙØ´Ù„'; msg.className='msg error'; msg.style.display='block'; }});

    // Ø­ÙØ¸ Ø§Ø®ØªØ¨Ø§Ø±
  document.getElementById('examForm').addEventListener('submit', async e=>{ e.preventDefault(); const msg=document.getElementById('examMsg'); msg.style.display='none'; const payload={ subject:exam_subject.value, class_level:exam_class.value, section:exam_section.value.trim(), title:exam_title.value.trim(), duration:Number(exam_duration.value), exam_date:exam_date.value }; if(!payload.subject||!payload.class_level||!payload.title||!payload.duration||!payload.exam_date){ msg.textContent='Ø§ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„'; msg.className='msg error'; msg.style.display='block'; return;} try{ const r=await apiFetch('api/teacher.php?path=exam',{method:'POST',headers:auth(),body:JSON.stringify(payload)}); const d=await r.json(); if(!d.ok){ throw 0;} msg.textContent='ØªÙ… Ø§Ù„Ø­ÙØ¸'; msg.className='msg ok'; msg.style.display='block'; e.target.reset(); loadExams(); }catch{ msg.textContent='ÙØ´Ù„'; msg.className='msg error'; msg.style.display='block'; }});

    // ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø§Ø¨ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
  document.getElementById('loadStudents').addEventListener('click', async ()=>{ const subject=grade_subject.value; const grade=grade_class.value; const sec=grade_section.value.trim(); if(!subject||!grade||!sec){ gradeMsg.textContent='Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'; gradeMsg.className='msg error'; gradeMsg.style.display='block'; return;} const tb=studentsList; tb.innerHTML='<tr><td colspan="4" class="muted text-center">ØªØ­Ù…ÙŠÙ„...</td></tr>'; try{ const r=await apiFetch(`api/teacher.php?path=students&class=${encodeURIComponent(grade)}&section=${encodeURIComponent(sec)}`,{headers:auth()}); const d=await r.json(); if(!d.ok||!d.data?.length){ tb.innerHTML='<tr><td colspan="4" class="muted text-center">Ù„Ø§ Ø·Ù„Ø§Ø¨</td></tr>'; return;} tb.innerHTML=d.data.map(st=>`<tr><td>${st.full_name}</td><td>${st.email}</td><td><input type='number' min='0' max='100' step='0.1' data-email='${st.email}' class='w-80'/></td><td><button class="btn btn-primary" onclick="saveGrade('${st.email}')">Ø­ÙØ¸</button></td></tr>`).join(''); }catch{ tb.innerHTML='<tr><td colspan="4" class="muted text-center">Ø®Ø·Ø£</td></tr>'; }});

  window.saveGrade = async (email)=>{ const subject=grade_subject.value; const term=grade_term.value; const month=grade_month.value; const inp=document.querySelector(`input[data-email='${email}']`); const grade=inp.value; if(!subject||!term||!month||!grade){ gradeMsg.textContent='Ø£ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„'; gradeMsg.className='msg error'; gradeMsg.style.display='block'; return;} try{ const r=await apiFetch('api/teacher.php?path=grade',{method:'POST',headers:auth(),body:JSON.stringify({ email, subject, term, month:Number(month), grade:Number(grade) })}); const d=await r.json(); if(!d.ok) throw 0; gradeMsg.textContent='ØªÙ… Ø§Ù„Ø­ÙØ¸'; gradeMsg.className='msg ok'; gradeMsg.style.display='block'; inp.value=''; }catch{ gradeMsg.textContent='ÙØ´Ù„'; gradeMsg.className='msg error'; gradeMsg.style.display='block'; }};

  async function loadTeacherSchedule(){ const sem=teacherSemester.value; const qs= sem?`&semester=${sem}`:''; const tb=document.getElementById('teacherSchedule'); tb.innerHTML='<tr><td colspan="5" class="muted text-center">ØªØ­Ù…ÙŠÙ„...</td></tr>'; try{ const r=await apiFetch('api/teacher.php?path=schedule'+qs,{headers:auth()}); const d=await r.json(); if(!d.ok||!d.items.length){ tb.innerHTML='<tr><td colspan="5" class="muted text-center">Ù„Ø§ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>'; return;} tb.innerHTML=d.items.map(i=>`<tr><td>${i.semester||''}</td><td>${i.grade||''}</td><td>${i.day}</td><td>${i.period}</td><td>${i.subject}</td></tr>`).join(''); }catch{ tb.innerHTML='<tr><td colspan="5" class="muted text-center">Ø®Ø·Ø£</td></tr>'; }}

  function downloadSchedule(){ window.open(buildApiUrl('api/teacher.php?path=schedule/print'),'_blank'); }
  function downloadIdCard(){ window.open(buildApiUrl('api/teacher.php?path=id-card'),'_blank'); }

  // Smooth scroll to sections
  function scrollToSection(id){ const el=document.getElementById(id); if(el){ el.scrollIntoView({behavior:'smooth', block:'start'}); } }

  // Profile modal helpers
  function openProfile(){ const m=document.getElementById('profileModal'); if(m){ m.style.display='flex'; } }
  function closeProfile(){ const m=document.getElementById('profileModal'); if(m){ m.style.display='none'; } }
  (function(){ const m=document.getElementById('profileModal'); if(m){ m.addEventListener('click', (e)=>{ if(e.target.id==='profileModal'){ closeProfile(); } }); }} )();
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape'){ closeProfile(); }});

  // Notifications bar and toast
  function closeNotification(){ const bar=document.getElementById('notificationsBar'); if(!bar) return; bar.style.top='-60px'; setTimeout(()=>{ bar.style.display='none'; },300); }
  function showToast(text, type='info'){
    const bar=document.getElementById('notificationsBar'); const msg=document.getElementById('notificationMsg');
    if(!bar||!msg) return;
    msg.innerHTML = (type==='ok'?'âœ… ':'â„¹ï¸ ')+text;
    bar.style.display='flex'; bar.style.top='0';
    clearTimeout(window.__toastT);
    window.__toastT = setTimeout(()=>{ closeNotification(); }, 3000);
  }

  // Dark mode toggle
  function toggleDarkMode(){ const b=document.body; b.classList.toggle('dark-mode'); localStorage.setItem('darkMode', b.classList.contains('dark-mode')?'1':'0'); }

  // Generic table filter (client-side)
  function filterTable(tableId, inputId){ const input=document.getElementById(inputId); const tb=document.getElementById(tableId); if(!input||!tb) return; const q=(input.value||'').toLowerCase(); Array.from(tb.querySelectorAll('tr')).forEach(tr=>{ if(tr.querySelector('td')){ tr.style.display = tr.textContent.toLowerCase().includes(q)?'':'none'; } }); }

  // CSV exports
  function exportTableCSV(tableId, filename){ const table = document.getElementById(tableId)?.closest('table'); if(!table) return; const rows = Array.from(table.querySelectorAll('tr')).map(tr=> Array.from(tr.children).map(td=> '"'+(td.textContent||'').replace(/"/g,'""')+'"').join(',')); const blob = new Blob([rows.join('\n')], {type:'text/csv;charset=utf-8;'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=filename||'export.csv'; a.click(); URL.revokeObjectURL(a.href); }
  function exportFilesCSV(){ const items = Array.from(document.querySelectorAll('#fileList li span:first-child')).map(s=> s.textContent.trim()); if(!items.length){ showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù„Ù„ØªØµØ¯ÙŠØ±'); return; } const blob = new Blob([items.map(t=>'"'+t.replace(/"/g,'""')+'"').join('\n')], {type:'text/csv;charset=utf-8;'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='files.csv'; a.click(); URL.revokeObjectURL(a.href); }

  // Messages center (local demo)
  const __messages = [];
  document.getElementById('messageForm').addEventListener('submit', (e)=>{
    e.preventDefault(); const to=msgTo.value.trim(); const subject=msgSubject.value.trim(); const body=msgBody.value.trim();
    if(!to||!subject||!body) return;
    __messages.unshift({ date:new Date().toLocaleString('ar-EG'), to, subject, body });
    renderMessages(); e.target.reset(); showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©','ok');
  });
  function renderMessages(){ const tb=document.getElementById('messagesTable'); if(!tb) return; const q=(document.getElementById('msgSearch').value||'').toLowerCase(); if(!__messages.length){ tb.innerHTML='<tr><td colspan="4" class="muted text-center">Ù„Ø§ Ø±Ø³Ø§Ø¦Ù„</td></tr>'; return; } tb.innerHTML = __messages.filter(m=> (m.to+m.subject+m.body).toLowerCase().includes(q)).map(m=>`<tr><td>${m.date}</td><td>${m.to}</td><td>${m.subject}</td><td>${m.body}</td></tr>`).join(''); }
  function filterMessages(){ renderMessages(); }
  function clearMessages(){ __messages.length=0; renderMessages(); }

  // Files center (local demo)
  document.getElementById('fileForm').addEventListener('submit', (e)=>{
    e.preventDefault(); const file=document.getElementById('fileInput').files[0]; const label=(document.getElementById('fileLabel').value||'').trim(); if(!file) return;
    const li=document.createElement('li'); li.innerHTML = `<span>${label||file.name}</span> <span class="badge-type">${file.type||'Ù…Ù„Ù'}</span>`;
    document.getElementById('fileList').appendChild(li); e.target.reset(); showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ù','ok');
  });

    const attList = document.getElementById('attendanceList');
    document.getElementById('loadAttStudents').addEventListener('click', async ()=>{
      const grade = att_class.value; const sec = att_section.value.trim();
      attList.innerHTML='<tr><td colspan="3" class="muted text-center">ØªØ­Ù…ÙŠÙ„...</td></tr>';
  try { const r= await apiFetch(`api/teacher.php?path=students&grade_level=${encodeURIComponent(grade)}&section=${encodeURIComponent(sec)}`, { headers: auth() }); const d= await r.json(); if(!d.ok||!d.students?.length){ attList.innerHTML='<tr><td colspan="3" class="muted text-center">Ù„Ø§ Ø·Ù„Ø§Ø¨</td></tr>'; return; } attList.innerHTML = d.students.map(st=>`<tr data-id='${st.id}'><td>${st.full_name||st.name}</td><td><select data-status><option value='present'>Ø­Ø§Ø¶Ø±</option><option value='absent'>ØºØ§Ø¦Ø¨</option><option value='late'>Ù…ØªØ£Ø®Ø±</option></select></td><td><button class="btn btn-primary" onclick="saveAttendance(${st.id})">Ø­ÙØ¸</button></td></tr>`).join(''); } catch { attList.innerHTML='<tr><td colspan="3" class="muted text-center">Ø®Ø·Ø£</td></tr>'; }
    });
    document.getElementById('markAllPresent').addEventListener('click', ()=>{ attList.querySelectorAll('select[data-status]').forEach(s=> s.value='present'); });
  window.saveAttendance = async (sid)=>{ const row = attList.querySelector(`tr[data-id='${sid}']`); const status = row.querySelector('select[data-status]').value; try { const r= await apiFetch('api/attendance.php',{ method:'POST', headers: auth(), body: JSON.stringify({ student_id:sid, status }) }); const d= await r.json(); if(d.ok){ attendanceMsg.textContent='ØªÙ… Ø§Ù„Ø­ÙØ¸'; attendanceMsg.className='msg ok'; } else { attendanceMsg.textContent='ÙØ´Ù„'; attendanceMsg.className='msg error'; } } catch { attendanceMsg.textContent='Ø®Ø·Ø£'; attendanceMsg.className='msg error'; } attendanceMsg.style.display='block'; };

    document.getElementById('downloadAttPdf').addEventListener('click', async ()=>{
      const f=attFromT.value; const t=attToT.value; const qs=(f||t)?`&${f?`from=${encodeURIComponent(f)}`:''}${f&&t?'&':''}${t?`to=${encodeURIComponent(t)}`:''}`:'';
      const url = buildApiUrl(`api/api.php?action=attendance_report${qs}`);
      try {
        const token = localStorage.getItem('authToken');
        const res = await fetch(url, { headers: { 'Authorization': `Bearer ${token}` } });
        if(!res.ok) throw new Error('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
        const blob = await res.blob();
        const dl = document.createElement('a');
        dl.href = URL.createObjectURL(blob);
        dl.download = 'attendance.csv';
        document.body.appendChild(dl); dl.click(); dl.remove();
        setTimeout(()=> URL.revokeObjectURL(dl.href), 1000);
      } catch { showToast('ÙØ´Ù„ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±','error'); }
    });
  </script>
</body>
</html>
